<!DOCTYPE html>
<html lang="en-US">
    <head>
        <meta charset="utf-8"> 
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="author" content="Liuwei" />
        <meta name="copyright" content="Liuwei" />

<meta name="keywords" content="poi, java, Java, " />
        <title>用poi将Excel数据导入数据库/java tools.jar动态类的生成  · Liuwei code
</title>
        <link href="http://cdn-images.mailchimp.com/embedcode/slim-081711.css" rel="stylesheet" type="text/css">
        <link href="http://liuwei.co/theme/css/bootstrap-combined.min.css" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="http://liuwei.co/theme/css/style.css" media="screen">
        <link rel="stylesheet" type="text/css" href="http://liuwei.co/theme/css/solarizedlight.css" media="screen">
        <link rel="shortcut icon" href="http://liuwei.co/theme/images/favicon.ico" type="image/x-icon" />
        <link rel="apple-touch-icon" href="http://liuwei.co/theme/images/apple-touch-icon.png" />
        <link rel="apple-touch-icon" sizes="57x57" href="http://liuwei.co/theme/images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="http://liuwei.co/theme/images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="http://liuwei.co/theme/images/apple-touch-icon-114x114.png" />
        <link rel="apple-touch-icon" sizes="144x144" href="http://liuwei.co/theme/images/apple-touch-icon-144x144.png" />
        <link rel="icon" href="http://liuwei.co/theme/images/apple-touch-icon-144x144.png" />
        <link href="http://liuwei.co/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Liuwei code - Full Atom Feed" />
        <link href="http://liuwei.co/feeds/Java.atom.xml" type="application/atom+xml" rel="alternate" title="Liuwei code - Java Category Atom Feed" />
        <link href="http://liuwei.co/feeds/Linux.atom.xml" type="application/atom+xml" rel="alternate" title="Liuwei code - Linux Category Atom Feed" />
        <link href="http://liuwei.co/feeds/Ubuntu.atom.xml" type="application/atom+xml" rel="alternate" title="Liuwei code - Ubuntu Category Atom Feed" />
    </head>
    <body>
        <div id="content-sans-footer">
        <div class="navbar navbar-static-top">
            <div class="navbar-inner">
                <div class="container">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="http://liuwei.co/"><span class=site-name>Liuwei code</span></a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right top-menu">
                            <li ><a href="http://liuwei.co">Home</a></li>
                            <li ><a href="http://liuwei.co/categories.html">Categories</a></li>
                            <li ><a href="http://liuwei.co/tags.html">Tags</a></li>
                            <li ><a href="http://liuwei.co/archives.html">Archives</a></li>
                            <li><form class="navbar-search" action="http://liuwei.co/search.html" onsubmit="return validateForm(this.elements['q'].value);"> <input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span1"></div>
                <div class="span10">
<article>
<div class="row-fluid">
    <header class="page_header span10 offset2">
    <h1><a href="http://liuwei.co/java/import-database-from-excel-use-java-poi.html"> 用poi将Excel数据导入数据库/java tools.jar动态类的生成  </a></h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">

            <p>由于公司对于Excel的导入导出用的比较多，因此这两天想写一个导入导出的小程序，方便以后使用，对于Excel的操作，本人使用的是poi，poi操作Excel非常方便，但有个缺点，对于Excel单元格的格式，poi在org.apache.poi.hssf.usermodel.HSSFCell中定义，大致包括以下几种类型：</p>
<div class="highlight"><pre><span class="n">HSSFCell</span><span class="p">.</span><span class="n">CELL_TYPE_NUMERIC</span><span class="p">;</span><span class="c1">//数字格式</span>
<span class="n">HSSFCell</span><span class="p">.</span><span class="n">CELL_TYPE_STRING</span><span class="p">;</span><span class="c1">//字符串（默认）</span>
<span class="n">HSSFCell</span><span class="p">.</span><span class="n">CELL_TYPE_FORMULA</span><span class="p">;</span><span class="c1">//公式</span>
<span class="n">HSSFCell</span><span class="p">.</span><span class="n">CELL_TYPE_BLANK</span><span class="p">;</span><span class="c1">//空白</span>
<span class="n">HSSFCell</span><span class="p">.</span><span class="n">CELL_TYPE_BOOLEAN</span><span class="p">;</span><span class="c1">//布尔</span>
<span class="n">HSSFCell</span><span class="p">.</span><span class="n">CELL_TYPE_ERROR</span><span class="p">;</span><span class="c1">//错误</span>
</pre></div>


<p>因此在读取Excel中整数的时候，读取上来会出现“.0”的情况，查了资料，也csdn发帖，最后还是需要程序处理，不知道哪位高手有更好的办法。这也许是poi的一个bug吧.</p>
<p>下面是我写的一个导入数据库的例子程序：
完整源码请查看：https://github.com/czzl/EXCELTOOL
首先是配置文件config.xml</p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=”1.0″ encoding=”UTF-8″ ?&gt;</span>

<span class="nt">&lt;root&gt;</span>

<span class="cp">&lt;!– 数据库连接信息 –&gt;</span>

<span class="nt">&lt;db_conection&gt;</span>

<span class="nt">&lt;driver_class&gt;</span>

com.microsoft.sqlserver.jdbc.SQLServerDriver

<span class="nt">&lt;/driver_class&gt;</span>

<span class="nt">&lt;url&gt;</span>

jdbc:sqlserver://localhost:1433;databaseName=excelTest

<span class="nt">&lt;/url&gt;</span>

<span class="nt">&lt;user&gt;</span>sa<span class="nt">&lt;/user&gt;</span>

<span class="nt">&lt;pass&gt;</span>123456<span class="nt">&lt;/pass&gt;</span>

<span class="nt">&lt;/db_conection&gt;</span>

<span class="cp">&lt;!–基础配置信息–&gt;</span>

<span class="nt">&lt;base_config&gt;</span>

<span class="cp">&lt;!–定义日志文件–&gt;</span>

<span class="nt">&lt;log_file&gt;</span>D:\excelImport.log<span class="nt">&lt;/log_file&gt;</span>

<span class="nt">&lt;/base_config&gt;</span>

<span class="cp">&lt;!– 配置每个Excel文件的导入信息 –&gt;</span>

<span class="nt">&lt;Excel</span> <span class="na">path=</span><span class="s">”etc/test.xls”</span><span class="nt">&gt;</span>

<span class="cp">&lt;!–className:动态创建的类名(默认为DynamicExcel) , sheetName:Excel一张sheet的名字 , table:数据库表名称(必须的) ,index: 表明是第几张sheet(必须的) –&gt;</span>

<span class="nt">&lt;sheet</span> <span class="na">className=</span><span class="s">”DynamicExcel”</span> <span class="na">sheetName=</span><span class="s">”sheet1″</span> <span class="na">table=</span><span class="s">”TB_Test1″</span> <span class="na">index=</span><span class="s">”2″</span> <span class="na">autoCommitRowIndex=</span><span class="s">”5″</span><span class="nt">&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”orderDate”</span> <span class="na">database_column=</span><span class="s">”orderDate”</span> <span class="na">file_column_index=</span><span class="s">”1″/</span><span class="nt">&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”orderNum”</span> <span class="na">database_column=</span><span class="s">”orderNum”</span> <span class="na">file_column_index=</span><span class="s">”2″</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”model”</span> <span class="na">database_column=</span><span class="s">”model”</span> <span class="na">file_column_index=</span><span class="s">”3″</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”quantity”</span> <span class="na">database_column=</span><span class="s">”quantity”</span> <span class="na">file_column_index=</span><span class="s">”4″</span> <span class="nt">/&gt;</span>

    <span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”remark”</span> <span class="na">database_column=</span><span class="s">”remark”</span> <span class="na">file_column_index=</span><span class="s">”5″</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/sheet&gt;</span>

<span class="nt">&lt;sheet</span> <span class="na">className=</span><span class="s">”DynamicExcel2″</span> <span class="na">sheetName=</span><span class="s">”sheet2″</span> <span class="na">table=</span><span class="s">”TB_Test2″</span> <span class="na">index=</span><span class="s">”1″</span> <span class="na">autoCommitRowIndex=</span><span class="s">”1000″</span><span class="nt">&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”orderDate”</span> <span class="na">database_column=</span><span class="s">”orderDate”</span> <span class="na">file_column_index=</span><span class="s">”1″/</span><span class="nt">&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”orderNum”</span> <span class="na">database_column=</span><span class="s">”orderNum”</span> <span class="na">file_column_index=</span><span class="s">”2″</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”model”</span> <span class="na">database_column=</span><span class="s">”model”</span> <span class="na">file_column_index=</span><span class="s">”3″</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”quantity”</span> <span class="na">database_column=</span><span class="s">”quantity”</span> <span class="na">file_column_index=</span><span class="s">”4″</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;column</span> <span class="na">field=</span><span class="s">”remark”</span> <span class="na">database_column=</span><span class="s">”remark”</span> <span class="na">file_column_index=</span><span class="s">”5″</span> <span class="nt">/&gt;</span>

<span class="nt">&lt;/sheet&gt;</span>

<span class="nt">&lt;/Excel&gt;</span>

<span class="nt">&lt;/root&gt;</span>
</pre></div>


<p>接下来利用jdom解析这个配置文件，然后利用tools.jar动态生成java类并编译：</p>
<div class="highlight"><pre><span class="n">package</span> <span class="n">com</span><span class="p">.</span><span class="n">william</span><span class="p">.</span><span class="n">excel</span><span class="p">.</span><span class="n">utils</span><span class="p">;</span>

<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">FileWriter</span><span class="p">;</span>

<span class="cm">/**</span>
<span class="cm">* 该类用于根据etc/config.xml的配置信息动态创建类</span>
<span class="cm">* 创建类的默认名字为”DynamicExcel”</span>
<span class="cm">* @author it2</span>
<span class="cm">*</span>
<span class="cm">*/</span>
<span class="n">public</span> <span class="n">class</span> <span class="n">CreateDynamicExcel</span> <span class="p">{</span>
<span class="n">private</span> <span class="n">String</span> <span class="n">CLASS_NAME</span><span class="o">=</span><span class="err">”</span><span class="n">DynamicExcel</span><span class="err">”</span><span class="p">;</span><span class="c1">//创建动态类的类名,默认为：DynamicExcel</span>
<span class="n">private</span> <span class="n">String</span> <span class="n">CLASS_FILE</span> <span class="o">=</span> <span class="n">CLASS_NAME</span> <span class="o">+</span> <span class="err">“</span><span class="p">.</span><span class="n">java</span><span class="err">”</span><span class="p">;</span><span class="c1">//创建动态类的文件名（以.java为拓展名）</span>
<span class="n">private</span> <span class="n">String</span><span class="p">[]</span> <span class="n">properties</span><span class="p">;</span><span class="c1">//创建动态类的属性集合</span>
<span class="n">public</span> <span class="nf">CreateDynamicExcel</span><span class="p">(</span><span class="n">String</span> <span class="n">className</span> <span class="p">,</span> <span class="n">String</span><span class="p">[]</span> <span class="n">properties</span><span class="p">){</span>
<span class="k">if</span><span class="p">(</span><span class="n">className</span><span class="o">!=</span><span class="n">null</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="err">”</span><span class="s">&quot;.equals(className.trim())){</span>
<span class="n">this</span><span class="p">.</span><span class="n">CLASS_NAME</span> <span class="o">=</span> <span class="n">className</span><span class="p">;</span>
<span class="n">this</span><span class="p">.</span><span class="n">CLASS_FILE</span><span class="o">=</span><span class="n">className</span><span class="o">+</span><span class="err">”</span><span class="p">.</span><span class="n">java</span><span class="err">”</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">this</span><span class="p">.</span><span class="n">properties</span> <span class="o">=</span> <span class="n">properties</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//动态创建类</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">createClass</span><span class="p">()</span> <span class="p">{</span>
<span class="n">try</span> <span class="p">{</span>
<span class="n">new</span> <span class="n">File</span><span class="p">(</span><span class="n">CLASS_FILE</span><span class="p">).</span><span class="n">delete</span><span class="p">();</span>
<span class="n">FileWriter</span> <span class="n">fw</span> <span class="o">=</span> <span class="n">new</span> <span class="n">FileWriter</span><span class="p">(</span><span class="n">CLASS_FILE</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
<span class="c1">// 类</span>
<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="n">public</span> <span class="n">class</span> <span class="err">”</span> <span class="o">+</span> <span class="n">CLASS_NAME</span> <span class="o">+</span> <span class="err">“</span><span class="p">{</span><span class="err">“</span><span class="p">);</span>
<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">properties</span><span class="p">.</span><span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="n">String</span> <span class="n">field</span> <span class="o">=</span> <span class="n">properties</span><span class="p">;</span>
<span class="c1">// 属性</span>
<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="n">private</span> <span class="n">String</span> <span class="err">”</span> <span class="o">+</span> <span class="n">field</span> <span class="o">+</span> <span class="err">“</span><span class="p">;</span><span class="err">”</span><span class="p">);</span>
<span class="n">String</span> <span class="n">property</span> <span class="o">=</span> <span class="n">field</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">field</span><span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">field</span>
<span class="p">.</span><span class="n">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">toUpperCase</span><span class="p">());</span>
<span class="c1">// set方法</span>
<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="n">public</span> <span class="kt">void</span> <span class="n">set</span><span class="err">”</span> <span class="o">+</span> <span class="n">property</span> <span class="o">+</span> <span class="err">“</span><span class="p">(</span><span class="n">String</span> <span class="err">”</span> <span class="o">+</span> <span class="n">field</span>
<span class="o">+</span> <span class="err">“</span><span class="p">){</span><span class="err">“</span><span class="p">);</span>
<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="n">this</span><span class="p">.</span><span class="err">”</span> <span class="o">+</span> <span class="n">field</span> <span class="o">+</span> <span class="err">“</span><span class="o">=</span><span class="err">”</span> <span class="o">+</span> <span class="n">field</span> <span class="o">+</span> <span class="err">“</span><span class="p">;</span><span class="err">”</span><span class="p">);</span>
<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="p">}</span><span class="err">”</span><span class="p">);</span>
<span class="c1">// get方法</span>
<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="n">public</span> <span class="n">String</span> <span class="n">get</span><span class="err">”</span> <span class="o">+</span> <span class="n">property</span> <span class="o">+</span> <span class="err">“</span><span class="p">(){</span><span class="err">“</span><span class="p">);</span>
<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="k">return</span> <span class="err">”</span> <span class="o">+</span> <span class="n">field</span> <span class="o">+</span> <span class="err">“</span><span class="p">;</span><span class="err">”</span><span class="p">);</span>
<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="p">}</span><span class="err">”</span><span class="p">);</span>

<span class="p">}</span>

<span class="n">fw</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="err">“</span><span class="p">}</span><span class="err">”</span><span class="p">);</span>
<span class="n">fw</span><span class="p">.</span><span class="n">flush</span><span class="p">();</span>
<span class="n">fw</span><span class="p">.</span><span class="n">close</span><span class="p">();</span>
<span class="p">}</span> <span class="n">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
<span class="n">e</span><span class="p">.</span><span class="n">printStackTrace</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="c1">//动态编译类</span>
<span class="n">public</span> <span class="kt">void</span> <span class="n">compileClass</span><span class="p">()</span> <span class="p">{</span>
<span class="n">String</span> <span class="n">filePath</span> <span class="o">=</span> <span class="n">new</span> <span class="n">File</span><span class="p">(</span><span class="n">CreateDynamicExcel</span><span class="p">.</span><span class="n">class</span><span class="p">.</span><span class="n">getClassLoader</span><span class="p">()</span>
<span class="p">.</span><span class="n">getResource</span><span class="p">(</span><span class="err">“”</span><span class="p">).</span><span class="n">getFile</span><span class="p">()).</span><span class="n">getAbsolutePath</span><span class="p">();</span>
<span class="n">String</span><span class="p">[]</span> <span class="n">source</span> <span class="o">=</span> <span class="p">{</span> <span class="err">“</span><span class="o">-</span><span class="n">d</span><span class="err">”</span><span class="p">,</span> <span class="n">filePath</span><span class="p">,</span> <span class="n">new</span> <span class="n">String</span><span class="p">(</span><span class="n">CLASS_FILE</span><span class="p">)</span> <span class="p">};</span>
<span class="n">System</span><span class="p">.</span><span class="n">out</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="err">“</span><span class="n">javac</span> <span class="n">out</span><span class="o">:</span><span class="err">”</span>
<span class="o">+</span> <span class="n">com</span><span class="p">.</span><span class="n">sun</span><span class="p">.</span><span class="n">tools</span><span class="p">.</span><span class="n">javac</span><span class="p">.</span><span class="n">Main</span><span class="p">.</span><span class="n">compile</span><span class="p">(</span><span class="n">source</span><span class="p">));</span>
<span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>之后用poi读取，并保存在动态类的集合中：</p>
<div class="highlight"><pre><span class="nx">package</span> <span class="nx">com.william.excel.service</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">java.io.File</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">java.io.FileInputStream</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">java.io.FileNotFoundException</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">java.io.IOException</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">java.lang.reflect.InvocationTargetException</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">java.lang.reflect.Method</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">java.util.List</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">org.apache.poi.hssf.usermodel.HSSFCell</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">org.apache.poi.hssf.usermodel.HSSFRow</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">org.apache.poi.hssf.usermodel.HSSFSheet</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">org.apache.poi.hssf.usermodel.HSSFWorkbook</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">org.apache.poi.poifs.filesystem.POIFSFileSystem</span><span class="p">;</span>

<span class="k">import</span> <span class="nx">com.william.excel.config.ColumnConfig</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">com.william.excel.config.Configuration</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">com.william.excel.config.SheetConfig</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">com.william.excel.log.Log</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">com.william.excel.utils.CreateDynamicExcel</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">com.william.excel.utils.DateUtils</span><span class="p">;</span>
<span class="k">import</span> <span class="nx">com.william.excel.utils.ExcelCellUtil</span><span class="p">;</span>

<span class="k">public</span> <span class="nf">class</span> <span class="nx">ReadExcel</span> <span class="p">{</span>

<span class="k">private</span> <span class="nf">HSSFWorkbook</span> <span class="nx">wb</span><span class="p">;</span>

<span class="k">private</span> <span class="nf">int</span> <span class="nx">rowsCount</span><span class="p">;</span>
<span class="k">public</span> <span class="nf">ReadExcel</span><span class="p">(</span><span class="na">String</span> <span class="nb">path</span><span class="p">)</span> <span class="p">{</span>
<span class="c1">//Log.writeLog(“\r\n”, true);</span>
<span class="k">Log</span><span class="bp">.</span><span class="nx">writeLog</span><span class="p">(</span><span class="err">“—————–”</span><span class="o">+</span><span class="nx">DateUtils.getLongSysDate</span><span class="p">()</span><span class="o">+</span><span class="err">”—————</span><span class="o">-</span><span class="err">”</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>
<span class="k">Log</span><span class="bp">.</span><span class="nx">writeLog</span><span class="p">(</span><span class="err">“开始读取：”</span><span class="o">+</span><span class="nb">path</span><span class="p">,</span><span class="kc">true</span><span class="p">);</span>

<span class="nb">File</span> <span class="n">checkFile</span> <span class="o">=</span> <span class="nb">new</span> <span class="nb">File</span><span class="p">(</span><span class="nb">path</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">checkFile.exists</span><span class="p">())</span> <span class="p">{</span>
<span class="nx">FileInputStream</span> <span class="nx">fis</span><span class="p">;</span>
<span class="nx">try</span> <span class="p">{</span>
<span class="n">fis</span> <span class="o">=</span> <span class="nb">new</span> <span class="nx">FileInputStream</span><span class="p">(</span><span class="nb">path</span><span class="p">);</span>
<span class="nx">POIFSFileSystem</span> <span class="n">fs</span> <span class="o">=</span> <span class="nb">new</span> <span class="nx">POIFSFileSystem</span><span class="p">(</span><span class="nx">fis</span><span class="p">);</span> <span class="c1">// 利用poi读取excel文件流</span>
<span class="n">this.wb</span> <span class="o">=</span> <span class="nb">new</span> <span class="nx">HSSFWorkbook</span><span class="p">(</span><span class="nx">fs</span><span class="p">);</span> <span class="c1">// 读取excel工作簿</span>
<span class="p">}</span> <span class="nx">catch</span> <span class="p">(</span><span class="nx">FileNotFoundException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">e.printStackTrace</span><span class="p">();</span>
<span class="p">}</span> <span class="nx">catch</span> <span class="p">(</span><span class="nx">IOException</span> <span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="nx">e.printStackTrace</span><span class="p">();</span>
<span class="p">}</span>
<span class="p">}</span>
<span class="p">}</span>

<span class="k">private</span> <span class="nf">HSSFSheet</span> <span class="nx">getSheet</span><span class="p">(</span><span class="nx">int</span> <span class="nx">sheetIndex</span><span class="p">)</span> <span class="p">{</span>
<span class="k">return</span> <span class="nx">wb.getSheetAt</span><span class="p">(</span><span class="nx">sheetIndex</span><span class="p">);</span>
<span class="p">}</span>

<span class="p">@</span><span class="nx">SuppressWarnings</span><span class="p">(</span><span class="err">“</span><span class="nx">unchecked</span><span class="err">”</span><span class="p">)</span>
<span class="k">public</span> <span class="nf">void</span> <span class="nb">run</span><span class="p">()</span> <span class="p">{</span>

<span class="nb">List</span><span class="o">&lt;</span><span class="nx">SheetConfig</span><span class="o">&gt;</span> <span class="n">sheetConfigs</span> <span class="o">=</span> <span class="nx">Configuration.getExcelConfig</span><span class="p">()</span>
<span class="bp">.</span><span class="nx">getSheets</span><span class="p">();</span>
<span class="nb">for</span> <span class="p">(</span><span class="nx">SheetConfig</span> <span class="nx">sc</span> <span class="p">:</span> <span class="nx">sheetConfigs</span><span class="p">)</span> <span class="p">{</span><span class="c1">// 判断有几张sheet表</span>
<span class="cm">/** ***********创建动态类Start**************** */</span>
<span class="kt">String</span> <span class="n">className</span> <span class="o">=</span> <span class="nx">sc.getClassName</span><span class="p">();</span>
<span class="nb">List</span><span class="o">&lt;</span><span class="nx">ColumnConfig</span><span class="o">&gt;</span> <span class="n">cc</span> <span class="o">=</span> <span class="nx">sc.getColumns</span><span class="p">();</span>
<span class="kt">String</span><span class="err">[</span><span class="cp">]</span> properties = new String<span class="cp">[</span><span class="nx">cc.size</span><span class="p">()</span><span class="cp">]</span>;
for (int i = 0; i <span class="nt">&lt; cc</span><span class="err">.</span><span class="na">size</span><span class="err">();</span> <span class="na">i</span><span class="err">++)</span> <span class="err">{</span>
<span class="na">properties =</span><span class="err"> </span><span class="s">cc.get(i).getField();</span>
<span class="err">}</span>
<span class="err">//</span> <span class="err">根据类名和属性集合创建动态类</span>
<span class="na">createExcelClass</span><span class="err">(</span><span class="na">className</span><span class="err">,</span> <span class="na">properties</span><span class="err">);</span>
<span class="err">/**</span> <span class="err">***********创建动态类</span><span class="na">End</span><span class="err">****************</span> <span class="err">*/</span>
<span class="na">Class</span> <span class="na">clazz =</span><span class="err"> </span><span class="s">null;</span>
<span class="na">try</span> <span class="err">{</span>
<span class="na">clazz =</span><span class="err"> </span><span class="s">Class.forName(className);</span>
<span class="err">}</span> <span class="na">catch</span> <span class="err">(</span><span class="na">ClassNotFoundException</span> <span class="na">e</span><span class="err">)</span> <span class="err">{</span>
<span class="na">e</span><span class="err">.</span><span class="na">printStackTrace</span><span class="err">();</span>
<span class="err">}</span>
<span class="err">//</span> <span class="err">行循环,并添加到集合中</span>
<span class="na">HSSFSheet</span> <span class="na">sheet =</span><span class="err"> </span><span class="s">getSheet(Integer.parseInt(sc.getIndex())</span> <span class="err">–</span> <span class="na">1</span><span class="err">);</span>
<span class="na">for</span> <span class="err">(</span><span class="na">int</span> <span class="na">i =</span><span class="err"> </span><span class="s">0;</span> <span class="na">i</span> <span class="err">&lt;</span> <span class="na">sheet</span><span class="err">.</span><span class="na">getPhysicalNumberOfRows</span><span class="err">();</span> <span class="na">i</span><span class="err">++)</span> <span class="err">{</span>
<span class="na">rowsCount =</span><span class="err"> </span><span class="s">i;</span>
<span class="na">HSSFRow</span> <span class="na">row =</span><span class="err"> </span><span class="s">sheet.getRow(i);</span> <span class="err">//</span> <span class="err">取出</span><span class="na">sheet</span><span class="err">中的某一行数据</span>
<span class="na">if</span> <span class="err">(</span><span class="na">row</span> <span class="err">!=</span> <span class="na">null</span><span class="err">)</span> <span class="err">{</span>
<span class="na">Object</span> <span class="na">obj =</span><span class="err"> </span><span class="s">null;</span>
<span class="na">try</span> <span class="err">{</span>
<span class="na">obj =</span><span class="err"> </span><span class="s">clazz.newInstance();</span>
<span class="err">}</span> <span class="na">catch</span> <span class="err">(</span><span class="na">InstantiationException</span> <span class="na">e</span><span class="err">)</span> <span class="err">{</span>
<span class="na">e</span><span class="err">.</span><span class="na">printStackTrace</span><span class="err">();</span>
<span class="err">}</span> <span class="na">catch</span> <span class="err">(</span><span class="na">IllegalAccessException</span> <span class="na">e</span><span class="err">)</span> <span class="err">{</span>
<span class="na">e</span><span class="err">.</span><span class="na">printStackTrace</span><span class="err">();</span>
<span class="err">}</span>
<span class="err">//</span> <span class="err">列循环</span>
<span class="na">for</span> <span class="err">(</span><span class="na">int</span> <span class="na">j =</span><span class="err"> </span><span class="s">0;</span> <span class="na">j</span> <span class="err">&lt;</span> <span class="na">cc</span><span class="err">.</span><span class="na">size</span><span class="err">();</span> <span class="na">j</span><span class="err">++)</span> <span class="err">{</span>
<span class="na">HSSFCell</span> <span class="na">cell =</span><span class="err"> </span><span class="s">row.getCell((short)</span> <span class="na">j</span><span class="err">);</span>
<span class="na">if</span> <span class="err">(</span><span class="na">cell</span> <span class="err">!=</span> <span class="na">null</span><span class="err">)</span> <span class="err">{</span>
<span class="na">if</span> <span class="err">(</span><span class="na">Integer</span><span class="err">.</span><span class="na">parseInt</span><span class="err">(</span><span class="na">cc</span><span class="err">.</span><span class="na">get</span><span class="err">(</span><span class="na">j</span><span class="err">)</span>
<span class="err">.</span><span class="na">getFile_column_index</span><span class="err">())</span> <span class="err">–</span> <span class="na">1 =</span><span class="s">=</span> <span class="na">j</span><span class="err">)</span> <span class="err">{</span>
<span class="na">Class</span> <span class="na">params</span><span class="cp">[]</span><span class="na"> =</span><span class="err"> </span><span class="s">{</span> <span class="na">String</span><span class="err">.</span><span class="na">class</span> <span class="err">};</span>
<span class="na">Object</span> <span class="na">paramsObj</span><span class="cp">[]</span><span class="na"> =</span><span class="err"> </span><span class="s">new</span> <span class="na">Object</span><span class="cp">[</span><span class="mi">1</span><span class="cp">]</span><span class="err">;</span>
<span class="na">Method</span> <span class="na">thisMethod</span><span class="err">;</span>
<span class="na">String</span> <span class="na">field =</span><span class="err"> </span><span class="s">null;</span>
<span class="na">try</span> <span class="err">{</span>
<span class="na">field =</span><span class="err"> </span><span class="s">cc.get(j).getField();</span>
<span class="na">field =</span><span class="err"> </span><span class="s">field.replace(</span>
<span class="na">field</span><span class="err">.</span><span class="na">substring</span><span class="err">(</span><span class="na">0</span><span class="err">,</span> <span class="na">1</span><span class="err">),</span> <span class="na">field</span>
<span class="err">.</span><span class="na">substring</span><span class="err">(</span><span class="na">0</span><span class="err">,</span> <span class="na">1</span><span class="err">)</span>
<span class="err">.</span><span class="na">toUpperCase</span><span class="err">());</span>
<span class="na">thisMethod =</span><span class="err"> </span><span class="s">clazz.getDeclaredMethod(“set”</span>
<span class="err">+</span> <span class="na">field</span><span class="err">,</span> <span class="na">params</span><span class="err">);</span>
<span class="na">paramsObj</span><span class="cp">[</span><span class="mi">0</span><span class="cp">]</span><span class="na"> =</span><span class="err"> </span><span class="s">ExcelCellUtil</span>
<span class="err">.</span><span class="na">getCellStringValue</span><span class="err">(</span><span class="na">cell</span><span class="err">);</span>
<span class="na">thisMethod</span><span class="err">.</span><span class="na">invoke</span><span class="err">(</span><span class="na">obj</span><span class="err">,</span> <span class="na">paramsObj</span><span class="err">);</span>

<span class="err">}</span> <span class="na">catch</span> <span class="err">(</span><span class="na">NoSuchMethodException</span> <span class="na">e</span><span class="err">)</span> <span class="err">{</span>
<span class="na">Log</span><span class="err">.</span><span class="na">writeLog</span><span class="err">(“新创建的动态类没有</span> <span class="na">set</span><span class="err">”</span> <span class="err">+</span> <span class="na">field</span>
<span class="err">+</span> <span class="err">”</span> <span class="err">方法”,</span> <span class="na">true</span><span class="err">);</span>
<span class="err">}</span> <span class="na">catch</span> <span class="err">(</span><span class="na">IllegalAccessException</span> <span class="na">e</span><span class="err">)</span> <span class="err">{</span>
<span class="na">Log</span><span class="err">.</span><span class="na">writeLog</span><span class="err">(“</span><span class="na">set</span><span class="err">”</span> <span class="err">+</span> <span class="na">field</span>
<span class="err">+</span> <span class="err">”</span> <span class="err">方法访问异常,请联系管理员。”,</span> <span class="na">true</span><span class="err">);</span>
<span class="err">}</span> <span class="na">catch</span> <span class="err">(</span><span class="na">InvocationTargetException</span> <span class="na">e</span><span class="err">)</span> <span class="err">{</span>
<span class="na">Log</span><span class="err">.</span><span class="na">writeLog</span><span class="err">(“</span><span class="na">set</span><span class="err">”</span> <span class="err">+</span> <span class="na">field</span>
<span class="err">+</span> <span class="err">”</span> <span class="err">方法反射异常,请联系管理员。”,</span> <span class="na">true</span><span class="err">);</span>
<span class="err">}</span>
<span class="err">}</span>
<span class="err">}</span>
<span class="err">}</span>
<span class="na">boolean</span> <span class="na">isException =</span><span class="err"> </span><span class="s">false;</span>
<span class="na">if</span><span class="err">(</span><span class="na">i</span><span class="err">%</span><span class="na">Integer</span><span class="err">.</span><span class="na">parseInt</span><span class="err">(</span><span class="na">sc</span><span class="err">.</span><span class="na">getAutoCommitRowIndex</span><span class="err">())==</span><span class="na">0</span><span class="err">){</span>
<span class="na">isException =</span><span class="err"> </span><span class="s">ExcelToData.insert(sc.getTable(),sc.getColumns(),obj,true);</span>
<span class="err">}</span><span class="na">else</span> <span class="na">if</span><span class="err">(</span><span class="na">i=</span><span class="s">=sheet.getPhysicalNumberOfRows()-1){</span>
<span class="na">isException =</span><span class="err"> </span><span class="s">ExcelToData.insert(sc.getTable(),sc.getColumns(),obj,true);</span>
<span class="err">}</span><span class="na">else</span><span class="err">{</span>
<span class="na">isException =</span><span class="err"> </span><span class="s">ExcelToData.insert(sc.getTable(),sc.getColumns(),obj,false);</span>
<span class="err">}</span>
<span class="na">if</span><span class="err">(</span><span class="na">isException</span><span class="err">){</span>
<span class="na">Log</span><span class="err">.</span><span class="na">writeLog</span><span class="err">(</span><span class="na">DateUtils</span><span class="err">.</span><span class="na">getLongSysDate</span><span class="err">()+”</span> <span class="na">ERROR:</span><span class="err">”,</span> <span class="na">true</span><span class="err">);</span>
<span class="na">Log</span><span class="err">.</span><span class="na">writeLog</span><span class="err">(“第”+</span><span class="na">i</span><span class="err">+”次插入或者提交事务发生异常,有可能导致数据不准确！”,</span> <span class="na">true</span><span class="err">);</span>
<span class="err">}</span>
<span class="err">}</span>

<span class="err">}</span>
<span class="na">finishRead</span><span class="err">(</span><span class="na">sc</span><span class="err">.</span><span class="na">getSheetName</span><span class="err">(),</span><span class="na">sc</span><span class="err">.</span><span class="na">getTable</span><span class="err">(),</span><span class="na">rowsCount</span><span class="err">);</span>
<span class="err">}</span>
<span class="err">}</span>

<span class="na">private</span> <span class="na">void</span> <span class="na">finishRead</span><span class="err">(</span><span class="na">String</span> <span class="na">sheetName</span> <span class="err">,</span><span class="na">String</span> <span class="na">tableName</span><span class="err">,</span> <span class="na">int</span> <span class="na">rowsCount</span><span class="err">){</span>
<span class="na">Log</span><span class="err">.</span><span class="na">writeLog</span><span class="err">(“读取完毕</span><span class="na">:</span><span class="err">”+</span><span class="na">DateUtils</span><span class="err">.</span><span class="na">getLongSysDate</span><span class="err">(),</span><span class="na">true</span><span class="err">);</span>
<span class="na">Log</span><span class="err">.</span><span class="na">writeLog</span><span class="err">(“从</span><span class="na">Excel</span><span class="err">【”+</span><span class="na">sheetName</span><span class="err">+”】导入数据库表【”+</span><span class="na">tableName</span><span class="err">+”】”+”【”+(</span><span class="na">rowsCount</span><span class="err">+</span><span class="na">1</span><span class="err">)+”】条数据”,</span><span class="na">true</span><span class="err">);</span>
<span class="err">}</span>
<span class="na">private</span> <span class="na">void</span> <span class="na">createExcelClass</span><span class="err">(</span><span class="na">String</span> <span class="na">className</span><span class="err">,</span> <span class="na">String</span><span class="cp">[]</span> <span class="na">properties</span><span class="err">)</span> <span class="err">{</span>
<span class="na">CreateDynamicExcel</span> <span class="na">dynamicExcel =</span><span class="err"> </span><span class="s">new</span> <span class="na">CreateDynamicExcel</span><span class="err">(</span><span class="na">className</span><span class="err">,</span>
<span class="na">properties</span><span class="err">);</span>
<span class="na">dynamicExcel</span><span class="err">.</span><span class="na">createClass</span><span class="err">();//</span> <span class="err">创建动态类</span>
<span class="na">dynamicExcel</span><span class="err">.</span><span class="na">compileClass</span><span class="err">();//</span> <span class="err">编译动态类</span>
<span class="err">}</span>
<span class="err">}</span>
</pre></div>
<!--  -->
<section>
<!-- <div class="accordion" id="accordion2">
    <div class="accordion-group">
        <div class="accordion-heading">
            <a class="accordion-toggle disqus-comment-count" data-toggle="collapse" data-parent="#accordion2"
                href="http://liuwei.co/java/import-database-from-excel-use-java-poi.html#disqus_thread">
                Comments
            </a>
        </div>
        <div id="disqus_thread" class="accordion-body collapse">
            <div class="accordion-inner">
                <div class="comments">
<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'suibian';
        var disqus_identifier = 'http://liuwei.co/java/import-database-from-excel-use-java-poi.html';
    var disqus_url = 'http://liuwei.co/java/import-database-from-excel-use-java-poi.html';

    (function() {
         var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
         dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
         (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>                </div>
            </div>
        </div>
    </div>
</div> -->

<!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="import-database-from-excel-use-java-poi" data-title="用poi将Excel数据导入数据库/java tools.jar动态类的生成" data-url="http://liuwei.co/java/import-database-from-excel-use-java-poi.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"liuweicode"};
    (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
    </script>
<!-- 多说公共JS代码 end -->

</section>
<!--  -->            <aside>
            <hr/>
            <nav>
            <ul class="articles_timeline">
 
                <li class="next_article"><a href="http://liuwei.co/ubuntu/connect-with-ipv6-on-ubuntu.html" title="Next: Ubuntu 通过ipv4转ipv6上网">Ubuntu 通过ipv4转ipv6上网</a> »</li>
            </ul>
            </nav>
            </aside>
        </div>
        <section>
        <div class="span2" style="float:right;font-size:0.9em;">
 
            <h4>Published</h4>
            <time pubdate="pubdate" datetime="2009-12-28T12:28:00">Dec 28, 2009</time>
 
            <h4>Last Updated</h4>
            <div class="last_updated">2009-12-28 12:28:00</div>
            <h4>Category</h4>
            <a class="category-link" href="/categories.html#Java-ref">Java</a> 
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article"> 
                <li><a href="/tags.html#java-ref">java
                    <span>2</span>
</a></li>
                <li><a href="/tags.html#poi-ref">poi
                    <span>1</span>
</a></li>
            </ul>

        </div>
        </section>
</div>
</article>
                </div>
                <div class="span1"></div>
            </div>
        </div>
    </div>
<footer>
<div id="footer">
    <ul class="footer-content">
        <li class="elegant-power">Powered by <a href="http://getpelican.com/" title="Pelican Home Page">Pelican</a>. Theme: <a href="http://oncrashreboot.com/pelican-elegant" title="Theme Elegant Home Page">Elegant</a> by <a href="http://oncrashreboot.com" title="Talha Mansoor Home Page">Talha Mansoor</a></li>
    </ul>
</div>
</footer>            <script src="http://liuwei.co/theme/tipuesearch/jquery-2.1.0.min.js"></script>
        <script src="http://liuwei.co/theme/tipuesearch/bootstrap.min.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

<script type="text/javascript">
    var disqus_shortname = 'suibian';

    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
    </script>
        <script  language="javascript" type="text/javascript">
            function uncollapse() {
                var hash_str = window.location.hash;
                if (window.location.hash.match(/^#comment-\d+$/))
                {
                    var hash_str = '#disqus_thread';
                }
                $(hash_str).collapse({
                    toggle: true
                    })
            }
        </script>

        <script type="text/javascript" language="JavaScript">
            uncollapse(); 
        </script>
    </body>
</html>